version: "1.0"
name: "mcp-server"

# Authentication
auth:
  # API Keys (traditional method)
  api_keys:
    - name: "main"
      key_hash: "sha256:1af16067fc0f37f16a54d69f103ca7e9fa71db70621ef24d8dfc75181263b0f1"
      permissions: ["*"]

  # OAuth (recommended for Claude Code / Codex)
  # Uses GitHub Device Flow - no redirect URLs needed
  oauth:
    enabled: true
    provider: "github"
    client_id: "${GITHUB_CLIENT_ID}"
    jwt_secret: "${JWT_SECRET}"
    token_expiry: "30d"
    # allowed_users: []  # Optional: restrict to specific GitHub usernames

# MCP Registry
mcps:
  # External MCPs (HTTP-based, proxied through server)
  external:
    - name: "linear"
      url: "https://mcp.linear.app/mcp"
      auth:
        type: "bearer"
        token: "${LINEAR_API_KEY}"
      enabled: true

    - name: "greptile"
      url: "https://api.greptile.com/mcp"
      auth:
        type: "bearer"
        token: "${GREPTILE_API_KEY}"
      enabled: true

    - name: "context7"
      url: "https://mcp.context7.com/mcp"
      auth:
        type: "api_key"
        header: "CONTEXT7_API_KEY"
        token: "${CONTEXT7_API_KEY}"
      enabled: true

    - name: "exa"
      url: "https://mcp.exa.ai/mcp?tools=web_search_exa,deep_search_exa,get_code_context_exa,crawling_exa"
      auth:
        type: "bearer"
        token: "${EXA_API_KEY}"
      enabled: true

  # Local MCPs (npm packages or local servers)
  local:
    - name: "typescript-lsp"
      command: "typescript-language-server"
      args: ["--stdio"]
      enabled: true

# Skills (instruction sets / agent prompts)
skills:
  - name: "code-simplifier"
    description: "Agent that simplifies and refines code for clarity, consistency, and maintainability"
    file: "./plugins/code-simplifier/agents/code-simplifier.md"
    tags: ["refactoring", "code-quality"]

  - name: "sync-setup"
    description: "Backup, restore, or transfer Claude Code local setup (hooks, plugins, settings)"
    file: "./skills/sync-setup.md"
    tags: ["utility", "setup", "transfer"]

  - name: "codex-plan"
    description: "Create a detailed implementation plan using Codex 5.2 with xhigh reasoning"
    file: "./skills/codex-plan.md"
    tags: ["planning", "codex"]

# Plugins (local plugins with hooks, commands, agents)
plugins:
  - name: "hookify"
    description: "Create hooks to prevent unwanted behaviors"
    path: "./plugins/hookify"
    runtime: "python"
    enabled: true

  - name: "ralph-loop"
    description: "Continuous self-referential AI loops for iterative development"
    path: "./plugins/ralph-loop"
    runtime: "shell"
    enabled: true

# Hooks (event handlers from plugins)
hooks:
  # Hookify hooks
  - name: "hookify-userpromptsubmit"
    trigger: "user.prompt.submit"
    action: "./plugins/hookify/hooks/userpromptsubmit.py"

  - name: "hookify-pretooluse"
    trigger: "tool.pre"
    action: "./plugins/hookify/hooks/pretooluse.py"

  - name: "hookify-posttooluse"
    trigger: "tool.post"
    action: "./plugins/hookify/hooks/posttooluse.py"

  # Ralph-loop hooks
  - name: "ralph-stop"
    trigger: "stop"
    action: "./plugins/ralph-loop/hooks/stop-hook.sh"

# IDE/Client Configurations
configs:
  claude:
    file: "./configs/CLAUDE.md"
  codex:
    file: "./configs/AGENTS.md"

# Memory (persistent context layer powered by mem0)
# Provides cross-session, cross-client memory for Claude Code, Codex, etc.
memory:
  enabled: true
  provider: "cloud"  # "local" for self-hosted, "cloud" for mem0.ai managed

  # Local provider config (when provider: "local")
  # Requires OPENAI_API_KEY for embeddings
  local:
    embedder:
      provider: "openai"
      model: "text-embedding-3-small"
    vectorStore:
      provider: "memory"  # memory (dev), sqlite, or qdrant
      # path: "./data/memory.db"  # For sqlite
    llm:
      provider: "openai"
      model: "gpt-4o-mini"

  # Cloud provider config (when provider: "cloud")
  # Get API key at https://app.mem0.ai
  cloud:
    apiKey: "${MEM0_API_KEY}"

# Secrets (environment variables needed)
secrets:
  provider: "env"
  required:
    - GREPTILE_API_KEY              # For Greptile MCP
    - LINEAR_API_KEY                # For Linear MCP
    - CONTEXT7_API_KEY              # For Context7 MCP
    - EXA_API_KEY                   # For Exa MCP
    - MEM0_API_KEY                  # For mem0 cloud memory
  optional:
    - OPENAI_API_KEY                # For mem0 local mode embeddings
